.. _sec_model:Model handling (model)----------------------Overview~~~~~~~~Evaluating models for observations~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~Models are evaluated by observations using the ``GObservation::model`` method. The ``GObservation::npred`` provides the number of predicted events by all models within the relevant dataspace for a given observation.:ref:`fig_calltree_model` shows the call tree of the ``GObservation::model`` (left) and ``GObservation::npred`` (right) methods. The top section shows the abstract methods, the bottom section shows the methods that are called for ``GModelSky`` models, i.e. models of celestial sources that are folded by the instrument response.For model evaluation, the ``GObservation::model`` method loops over all models in the ``GModels`` container and calls the ``GModel::eval_gradients`` method of each model. For ``GModelSky`` models, this invokes an integration over true time, true energy and all possible true photon arrival directions that may result in the observed event direction. The latter computation is performed by the abstract ``GResponse::irf`` method that needs to be implemented for each instrument.The ``GObservation::npred`` method performs an integration over observed time, observed energy and observed arrival direction. The two former are performed by the ``GObservation::npred_temp`` and ``GObservation::npred_spec`` methods within the ``GObservation`` class, the spatial integral is done within the ``GModel`` class by invoking the ``GModel::npred`` method. For ``GModelSky`` models, the integral is performed by the abstract ``GResponse::npred`` method that needs to be implemented for each instrument... _fig_calltree_model:.. figure:: calltree_model.png   :width: 100%   Call tree for model evaluation